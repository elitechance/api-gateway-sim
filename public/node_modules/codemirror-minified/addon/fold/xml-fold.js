'use strict';(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function l(a,b,d,c){this.line=b;this.ch=d;this.cm=a;this.text=a.getLine(b);this.min=c?Math.max(c.from,a.firstLine()):a.firstLine();this.max=c?Math.min(c.to-1,a.lastLine()):a.lastLine()}function m(a,b){return(a=a.cm.getTokenTypeAt(h(a.line,b)))&&/\btag\b/.test(a)}function t(a){if(!(a.line>=
a.max))return a.ch=0,a.text=a.cm.getLine(++a.line),!0}function u(a){if(!(a.line<=a.min))return a.text=a.cm.getLine(--a.line),a.ch=a.text.length,!0}function q(a){for(;;){var b=a.text.indexOf(">",a.ch);if(-1==b)if(t(a))continue;else break;if(m(a,b+1)){var d=a.text.lastIndexOf("/",b),d=-1<d&&!/\S/.test(a.text.slice(d+1,b));a.ch=b+1;return d?"selfClose":"regular"}a.ch=b+1}}function r(a){for(;;){var b=a.ch?a.text.lastIndexOf("<",a.ch-1):-1;if(-1==b)if(u(a))continue;else break;if(m(a,b+1)){n.lastIndex=
b;a.ch=b;var d=n.exec(a.text);if(d&&d.index==b)return d}else a.ch=b}}function v(a){for(;;){n.lastIndex=a.ch;var b=n.exec(a.text);if(!b)if(t(a))continue;else break;if(m(a,b.index+1))return a.ch=b.index+b[0].length,b;a.ch=b.index+1}}function p(a,b){for(var d=[];;){var c=v(a),g,f=a.line,k=a.ch-(c?c[0].length:0);if(!c||!(g=q(a)))break;if("selfClose"!=g)if(c[1]){for(var e=d.length-1;0<=e;--e)if(d[e]==c[2]){d.length=e;break}if(0>e&&(!b||b==c[2]))return{tag:c[2],from:h(f,k),to:h(a.line,a.ch)}}else d.push(c[2])}}
function w(a,b){for(var d=[];;){var c;a:for(c=a;;){var g=c.ch?c.text.lastIndexOf(">",c.ch-1):-1;if(-1==g)if(u(c))continue;else{c=void 0;break a}if(m(c,g+1)){var f=c.text.lastIndexOf("/",g),f=-1<f&&!/\S/.test(c.text.slice(f+1,g));c.ch=g+1;c=f?"selfClose":"regular";break a}else c.ch=g}if(!c)break;if("selfClose"==c)r(a);else{c=a.line;g=a.ch;f=r(a);if(!f)break;if(f[1])d.push(f[2]);else{for(var e=d.length-1;0<=e;--e)if(d[e]==f[2]){d.length=e;break}if(0>e&&(!b||b==f[2]))return{tag:f[2],from:h(a.line,a.ch),
to:h(c,g)}}}}}var h=e.Pos,n=/<(\/?)([A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD-:.0-9\u00B7\u0300-\u036F\u203F-\u2040]*)/g;e.registerHelper("fold","xml",function(a,b){for(a=new l(a,b.line,0);;){var d=v(a),c;if(!d||a.line!=b.line||!(c=q(a)))break;
if(!d[1]&&"selfClose"!=c)return b=h(a.line,a.ch),(a=p(a,d[2]))&&{from:b,to:a.from}}});e.findMatchingTag=function(a,b,d){var c=new l(a,b.line,b.ch,d);if(-1!=c.text.indexOf(">")||-1!=c.text.indexOf("<")){var e=q(c),f=e&&h(c.line,c.ch),k=e&&r(c);if(e&&k&&!(0<(c.line-b.line||c.ch-b.ch))){b={from:h(c.line,c.ch),to:f,tag:k[2]};if("selfClose"==e)return{open:b,close:null,at:"open"};if(k[1])return{open:w(c,k[2]),close:b,at:"close"};c=new l(a,f.line,f.ch,d);return{open:b,close:p(c,k[2]),at:"open"}}}};e.findEnclosingTag=
function(a,b,d){for(var c=new l(a,b.line,b.ch,d);;){var e=w(c);if(!e)break;var f=new l(a,b.line,b.ch,d);if(f=p(f,e.tag))return{open:e,close:f}}};e.scanForClosingTag=function(a,b,d,c){a=new l(a,b.line,b.ch,c?{from:0,to:c}:null);return p(a,d)}});
